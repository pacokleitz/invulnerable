package models

import "time"

type Vulnerability struct {
	ID              int        `db:"id" json:"id"`
	CVEID           string     `db:"cve_id" json:"cve_id"`
	PackageName     string     `db:"package_name" json:"package_name"`
	PackageVersion  string     `db:"package_version" json:"package_version"`
	PackageType     *string    `db:"package_type" json:"package_type,omitempty"`
	Severity        string     `db:"severity" json:"severity"`
	FixVersion      *string    `db:"fix_version" json:"fix_version,omitempty"`
	URL             *string    `db:"url" json:"url,omitempty"`
	Description     *string    `db:"description" json:"description,omitempty"`
	Status          string     `db:"status" json:"status"` // active, fixed, ignored, accepted
	FirstDetectedAt time.Time  `db:"first_detected_at" json:"first_detected_at"`
	LastSeenAt      time.Time  `db:"last_seen_at" json:"last_seen_at"`
	RemediationDate *time.Time `db:"remediation_date" json:"remediation_date,omitempty"`
	Notes           *string    `db:"notes" json:"notes,omitempty"`
	CreatedAt       time.Time  `db:"created_at" json:"created_at"`
	UpdatedAt       time.Time  `db:"updated_at" json:"updated_at"`
}

type VulnerabilityUpdate struct {
	Status *string `json:"status,omitempty"`
	Notes  *string `json:"notes,omitempty"`
}

// ScanVulnerability represents the junction table
type ScanVulnerability struct {
	ID              int       `db:"id" json:"id"`
	ScanID          int       `db:"scan_id" json:"scan_id"`
	VulnerabilityID int       `db:"vulnerability_id" json:"vulnerability_id"`
	CreatedAt       time.Time `db:"created_at" json:"created_at"`
}

// VulnerabilityWithImageInfo represents a vulnerability with image context for compliance tracking
type VulnerabilityWithImageInfo struct {
	Vulnerability
	ImageID          int       `db:"image_id" json:"image_id"`
	ImageName        string    `db:"image_name" json:"image_name"`
	ImageDigest      *string   `db:"image_digest" json:"image_digest,omitempty"`
	FirstDetectedAt  time.Time `db:"first_detected_at_for_image" json:"first_detected_at"` // Override to be per-image
	LatestScanID     int       `db:"latest_scan_id" json:"latest_scan_id"`
	LatestScanDate   time.Time `db:"latest_scan_date" json:"latest_scan_date"`
	SLACritical      int       `db:"sla_critical" json:"sla_critical"`
	SLAHigh          int       `db:"sla_high" json:"sla_high"`
	SLAMedium        int       `db:"sla_medium" json:"sla_medium"`
	SLALow           int       `db:"sla_low" json:"sla_low"`
}
