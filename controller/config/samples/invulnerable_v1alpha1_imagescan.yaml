apiVersion: invulnerable.io/v1alpha1
kind: ImageScan
metadata:
  name: web-dvwa-scan
  namespace: invulnerable
spec:
  # Container image to scan
  image: "vulnerables/web-dvwa:latest"

  # Scan schedule in cron format (daily at 2 AM)
  schedule: "*/5 * * * *"

  # TimeZone for the schedule (optional, e.g., "America/New_York", "Europe/Paris")
  # If not specified, uses the system timezone
  timeZone: "Europe/Paris"

  # SBOM format (cyclonedx or spdx)
  sbomFormat: "cyclonedx"

  # Webhook notifications (optional)
  # Send scan results to Slack, Microsoft Teams, or other webhook endpoints
  #
  # How to get webhook URLs:
  #   Slack: https://api.slack.com/messaging/webhooks
  #   Teams: https://learn.microsoft.com/en-us/microsoftteams/platform/webhooks-and-connectors/how-to/add-incoming-webhook
  #   Test: https://webhook.site (for testing)
  #
  # Notification includes:
  #   - Vulnerability counts by severity (Critical, High, Medium, Low)
  #   - Clickable link to view full scan results in the frontend
  #   - Color-coded by highest severity found
  webhook:
    # Webhook endpoint URL (required)
    url: https://webhook.site/dbc75677-2dbe-4e69-805e-76a0ec5c5644

    # Webhook format: "slack" or "teams" (default: slack)
    format: slack

    # Minimum severity to trigger notification (default: High)
    # Options: Critical, High, Medium, Low, Negligible
    # Example: "High" notifies only if Critical or High vulnerabilities are found
    minSeverity: High

    # Enable/disable webhook notifications (default: true)
    enabled: true

  # Suspend scanning (set to true to pause)
  suspend: false

  # Job history limits
  successfulJobsHistoryLimit: 3
  failedJobsHistoryLimit: 3

  # Resource requests and limits
  resources:
    requests:
      memory: "256Mi"
      cpu: "200m"
    limits:
      memory: "1Gi"
      cpu: "1000m"

  # Workspace size for image extraction (uses node disk space via emptyDir)
  # Recommended sizes:
  #   - Small images (<2GB): 5Gi
  #   - Medium images (2-8GB): 10Gi (default)
  #   - Large images (8-20GB): 20Gi
  #   - Very large images (20GB+): 30Gi+
  #
  # ⚠️  WARNING: Node disk space consideration
  # Multiple ImageScans run concurrently and share node disk:
  #   Example: 5 ImageScans × 20Gi = 100Gi total node disk usage
  #
  # To prevent exhausting node disk:
  #   1. Monitor node disk capacity
  #   2. Use ResourceQuotas to limit total emptyDir usage
  #   3. Use nodeSelector to schedule scans on nodes with large disks
  #   4. Keep workspaceSize reasonable for your use case
  workspaceSize: "10Gi"

  # API endpoint (optional, auto-detected if not specified)
  # apiEndpoint: "http://invulnerable-backend.invulnerable.svc.cluster.local:8080"

  # Scanner image configuration (optional)
  scannerImage:
    repository: "invulnerable-scanner"
    tag: "latest"
    pullPolicy: "Always"  # Always pull to get latest local build

  # Private Registry Authentication (optional)
  #
  # To scan images from private Docker registries, create a docker-registry secret:
  #
  #   kubectl create secret docker-registry my-registry-secret \
  #     --docker-server=myregistry.example.com \
  #     --docker-username=myuser \
  #     --docker-password=mypassword \
  #     --docker-email=myemail@example.com \
  #     -n invulnerable
  #
  # Then reference the secret(s) here:
  # imagePullSecrets:
  #   - name: my-registry-secret

  # Filter unfixed vulnerabilities (optional)
  #
  # Only report vulnerabilities that have fixes available.
  # When enabled, Grype will skip CVEs with no known fix.
  #
  # Default: false (report all vulnerabilities)
  # onlyFixed: true
